on:
  workflow_dispatch:
    inputs:
      gutenbergMobileVersion:
        required: true

jobs:
  create-pull-request:
    runs-on: ubuntu-latest
    env:
      GUTENBERG_MOBILE_VERSION: ${{ github.event.inputs.gutenbergMobileVersion }}
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Update Gutenberg Mobile Version
        run: |
          sed -i "s/ext\.gutenbergMobileVersion = '.*'/ext.gutenbergMobileVersion = '$GUTENBERG_MOBILE_VERSION'/g" build.gradle
      - name: Compute branch name
        id: compute_branch_name
        run: |
          if [[ $GUTENBERG_MOBILE_VERSION == *"-"* ]]; then
            # Get the substring up to "-" which should be either "trunk" or the PR number
            echo ::set-output name=branch_name::update-gb-mobile-version/for-$(echo $GUTENBERG_MOBILE_VERSION | cut -d'-' -f1)
          else
            # If the version doesn't contain a "-", it should be a tag
            echo ::set-output name=branch_name::update-gb-mobile-version/for-tag-$GUTENBERG_MOBILE_VERSION
          fi
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          commit-message: "Update gutenberg mobile version to ${{ GUTENBERG_MOBILE_VERSION }}"
          branch: ${{ steps.compute_branch_name.outputs.branch_name }}
          delete-branch: true
